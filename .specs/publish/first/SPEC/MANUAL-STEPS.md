# Manual Steps Required Before First Release

## 1. Configure npm OIDC Authentication

The workflow uses npm OIDC authentication for publishing, which is more secure and does **not** require an `NPM_TOKEN` secret. Instead, GitHub Actions exchanges an OIDC token directly with npm.

### Steps to Enable OIDC:

1. **Go to npm organization settings**:
   https://www.npmjs.com/settings/effect-native/packages

2. **For each package**, enable "Require two-factor authentication or an automation token, or a token generated by a trusted publisher" under Publishing access

3. **Link GitHub repository as trusted publisher**:
   - Go to each package settings
   - Under "Publishing access" â†’ "Configure trusted publishers"
   - Add `effect-native/ansilust` repository
   - Select the `release.yml` workflow

4. **Verify workflow has OIDC permissions** (already configured):
   ```yaml
   permissions:
     id-token: write  # Required for npm OIDC
   ```

### References:
- [npm OIDC docs](https://docs.npmjs.com/generating-provenance-statements)
- [GitHub OIDC for npm](https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-cloud-providers)

## 2. (Optional) Add AUR_SSH_KEY Secret

This is only needed if you want automatic AUR package updates.
Can be deferred until after v1.0.0.

```bash
# Generate SSH key for AUR
ssh-keygen -t ed25519 -C "ansilust@github-actions" -f ~/.ssh/aur_ansilust
# Add public key to AUR account settings
# Then add private key as secret:
gh secret set AUR_SSH_KEY -R effect-native/ansilust < ~/.ssh/aur_ansilust
```

## 3. Push Feature Branch and Test Workflow

```bash
cd /home/tom/Work/ansilust
git push -u origin feat/publish-v1
```

Then check GitHub Actions to see if the workflow syntax is valid.

## 4. Create Test Release (Optional Dry Run)

```bash
git tag v0.0.2-test.1
git push origin v0.0.2-test.1
# Watch GitHub Actions
# Delete tag after testing:
git push origin :refs/tags/v0.0.2-test.1
git tag -d v0.0.2-test.1
```

## 5. Create Real v1.0.0 Release

```bash
# Create changeset
npx changeset add
# Select major, describe: "Initial public release"

# Commit and push
git add .changeset/*.md
git commit -m "chore: add changeset for v1.0.0"
git push

# Wait for Changesets bot to create version PR
# Merge the version PR
# Release workflow will run automatically
```

## Verification After Release

```bash
# Test npm
npx ansilust@1.0.0 --help

# Test GitHub release
curl -fsSL https://github.com/effect-native/ansilust/releases/latest/download/SHA256SUMS

# Test install script (once website is deployed)
curl -fsSL https://ansilust.com/install | bash
```
